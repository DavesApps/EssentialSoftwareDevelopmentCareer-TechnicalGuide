See the code at https://github.com/DavesApps/AutoDisposal